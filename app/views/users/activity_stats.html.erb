<section class="widget chat companywall">
<header>
<legend><h4>
    Activity Log History
</h4></legend>
</header>

<script type="text/javascript" charset="utf-8">
  $(function () {
      new Highcharts.Chart({  
        chart: { renderTo: "activity_chart", type: 'area' },
        title: { text: "All Activity Points by Goal" },
        xAxis: { type: "datetime" },
        yAxis: { min: 0, title: { text: "Points"} },
        tooltip: {
        formatter: function () {
          return Highcharts.dateFormat("%B %e %Y", this.x) + ': ' +
          this.y +" points";
        }
        },    
        series: [
          <% current_user.goals.each do |goal|  %>
        {
          name: "<%= Activity.find_by(id: goal.activity_id).name %>",
          pointInterval: <%= 1.day * 1000 %>,
          pointStart: <%= 2.weeks.ago.at_midnight.to_i * 1000 %>,
          data: <%= (2.weeks.ago.to_date..Date.today).map{|date| ActivityLog.where(goal_id: goal).where("date(created_at) <= ?",date).sum(:points)} %>
         },
        <% end %>]
      });
});
</script>


<div>
<div id="activity_chart" style="width: 100%; height: 200px">
  </div>
  </div>



<div class="body pre-scrollable" id="activity-entries">
  <div id="chat" class="chat">
    <div id="stat-message" class="stats">
      <ul>
        <% current_user.goals.each do |goal| %>
          <% if goal.activity_logs.empty? %>
          <% else %>
            <li><h4><%= goal.name_of_activity_through_goal %></h4></li><br>
          <% end %>
          <% goal.activity_logs.each do |log| %>
            <% if log == nil %>
            <% else %>
              <div id="history-log">
                <li> Duration: <%= log.duration %> minutes</li>
                <li> Points: <%= log.points %></li>
                <li> Logged: <%= log.created_at.to_s(:just_date) %></li><br>
                <% if log == goal.activity_logs.last %>
                  <div class="action" id="remove-log">
                    <%= button_to "Remove Log", user_goal_activity_log_path(current_user, goal, log.id), :class => 'btn btn-danger', method: :delete %>
                  </div><br>
                <% end %>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>
</div>


</section>
